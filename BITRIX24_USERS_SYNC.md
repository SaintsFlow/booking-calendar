# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Bitrix24

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –º–µ–∂–¥—É –≤–∞—à–µ–π CRM Bitrix24 –∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π –∫–∞–ª–µ–Ω–¥–∞—Ä—è. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–∑ Bitrix24 –≤ –≤–∞—à—É —Å–∏—Å—Ç–µ–º—É –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

-   **–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**: –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 01:00 (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ `routes/console.php`)
-   **–†—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**: –ß–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫ Bitrix24 –∏–ª–∏ artisan –∫–æ–º–∞–Ω–¥—É
-   **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: –ò–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (ACTIVE = 'Y')

### –õ–æ–≥–∏–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

#### –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

1. **–ü–æ–∏—Å–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**:

    - –°–Ω–∞—á–∞–ª–∞ –ø–æ –ø–æ–ª—é `bitrix24_user_id`
    - –ó–∞—Ç–µ–º –ø–æ email, –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ

2. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö**:

    - –û–±–Ω–æ–≤–ª—è–µ—Ç `bitrix24_user_id`, `name`, `email`
    - **–ù–ï –∏–∑–º–µ–Ω—è–µ—Ç –ø–∞—Ä–æ–ª—å** (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
    - **–ù–ï –∏–∑–º–µ–Ω—è–µ—Ç —Ä–æ–ª—å** (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–∫—É—â—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É)

3. **–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö**:

    - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ä–æ–ª—å—é `employee`
    - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π –ø–∞—Ä–æ–ª—å (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è)
    - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `is_active = true`

4. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è**:
    - ID –∏–∑ Bitrix24 (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
    - Email (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö)
    - –ò–º—è (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è "–°–æ—Ç—Ä—É–¥–Ω–∏–∫ {ID}")

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ß–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí Bitrix24**
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ –≤–∫–ª—é—á–µ–Ω–∞
3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"**
4. –î–æ–∂–¥–∏—Ç–µ—Å—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–ø—É—Å–∫–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### –ß–µ—Ä–µ–∑ artisan –∫–æ–º–∞–Ω–¥—É

#### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö —Ç–µ–Ω–∞–Ω—Ç–æ–≤

```bash
php artisan bitrix24:sync-users
```

#### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ–Ω–∞–Ω—Ç–∞

```bash
php artisan bitrix24:sync-users --tenant=1
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

–ò–∑–º–µ–Ω–∏—Ç–µ –≤—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞ –≤ —Ñ–∞–π–ª–µ `routes/console.php`:

```php
// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –ë–∏—Ç—Ä–∏–∫—Å24 –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 01:00
Schedule::command('bitrix24:sync-users')->dailyAt('01:00');

// –ò–ª–∏ –∫–∞–∂–¥—ã–π —á–∞—Å
Schedule::command('bitrix24:sync-users')->hourly();

// –ò–ª–∏ –∫–∞–∂–¥—ã–µ 4 —á–∞—Å–∞
Schedule::command('bitrix24:sync-users')->everyFourHours();
```

## API Bitrix24

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–µ—Ç–æ–¥ `user.get` REST API:

```
GET https://your-portal.bitrix24.ru/rest/1/xxxxx/user.get
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞

-   `filter[ACTIVE]` = 'Y' - —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
-   `start` - –ø–æ–∑–∏—Ü–∏—è –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ (—à–∞–≥ 50)

### –í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –ø–æ–ª—è

-   `ID` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Bitrix24
-   `EMAIL` - Email (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è)
-   `NAME` - –ò–º—è
-   `LAST_NAME` - –§–∞–º–∏–ª–∏—è

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –§–∞–π–ª—ã

1. **Job**: `app/Jobs/CRM/SyncUsersFromBitrix24Job.php`

    - –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
    - –ü–∞–≥–∏–Ω–∞—Ü–∏—è (50 –∑–∞–ø–∏—Å–µ–π –∑–∞ —Ä–∞–∑)
    - –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

2. **Command**: `app/Console/Commands/SyncBitrix24Users.php`

    - CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–ø—Ü–∏–∏ `--tenant`
    - –ó–∞–ø—É—Å–∫ Job –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ–Ω–∞–Ω—Ç–∞

3. **Controller**: `app/Http/Controllers/Settings/Bitrix24SettingsController.php`

    - –ú–µ—Ç–æ–¥ `syncUsers()` –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
    - –î–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º

4. **API Client**: `app/Infrastructure/CRM/Bitrix24/Bitrix24ApiClient.php`

    - –ú–µ—Ç–æ–¥ `listUsers(array $filter, int $start)`
    - HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è Bitrix24 REST API

5. **Frontend**: `resources/js/Pages/Settings/Bitrix24.vue`
    - –ö–Ω–æ–ø–∫–∞ "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"
    - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
Bitrix24 REST API (user.get)
    ‚Üì
Bitrix24ApiClient::listUsers()
    ‚Üì
SyncUsersFromBitrix24Job
    ‚Üì
    ‚îú‚îÄ‚Üí –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ bitrix24_user_id
    ‚îú‚îÄ‚Üí –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –ø–æ–∏—Å–∫ –ø–æ email
    ‚îú‚îÄ‚Üí –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω ‚Üí update (–ë–ï–ó –ø–∞—Ä–æ–ª—è)
    ‚îî‚îÄ‚Üí –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí create (—Å–æ —Å–ª—É—á–∞–π–Ω—ã–º –ø–∞—Ä–æ–ª–µ–º)
    ‚Üì
Database (users table)
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ `storage/logs/laravel.log`:

-   `üîµ` - –ó–∞–ø—Ä–æ—Å –∫ API Bitrix24
-   `‚ûï` - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
-   `üîÑ` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
-   `‚úÖ` - –£—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
-   `‚ùå` - –û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
-   `‚ö†Ô∏è` - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (–ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)

### –ü—Ä–∏–º–µ—Ä—ã –ª–æ–≥–æ–≤

```
[info] ‚ûï –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑ Bitrix24
    user_id: 123
    bitrix24_user_id: 456
    name: –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤
    email: ivan@example.com

[info] üîÑ –û–±–Ω–æ–≤–ª—ë–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    user_id: 123
    bitrix24_user_id: 456
    name: –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤ –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π

[info] ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –¥–ª—è —Ç–µ–Ω–∞–Ω—Ç–∞ 1
    synced: 25
    created: 3
    updated: 22
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –í–∞–∂–Ω–æ!

1. **–ü–∞—Ä–æ–ª–∏ –ù–ï —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è** - —ç—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
2. **–†–æ–ª–∏ –ù–ï –∏–∑–º–µ–Ω—è—é—Ç—Å—è** –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ - –∞–¥–º–∏–Ω—ã –æ—Å—Ç–∞—é—Ç—Å—è –∞–¥–º–∏–Ω–∞–º–∏
3. **–ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Å —Ä–æ–ª—å—é `employee`**
4. **Webhook URL —Å–∫—Ä—ã—Ç** –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

-   –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
-   –ù–∞–∑–Ω–∞—á—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–æ–ª–∏ –≤—Ä—É—á–Ω—É—é –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
-   –û—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–æ–≤—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é –ø–∞—Ä–æ–ª—è
-   –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

## –ü–æ–ª–µ bitrix24_user_id

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–°–≤—è–∑—ã–≤–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –≤ Bitrix24.

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

-   **–ü—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è ID –∏–∑ Bitrix24
-   **–í —Ñ–æ—Ä–º–∞—Ö**: –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –≤—Ä—É—á–Ω—É—é –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
-   **–í API**: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–¥–µ–ª–æ–∫ –∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤

### –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```sql
-- –ú–∏–≥—Ä–∞—Ü–∏—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –≤–∞—à–µ–π –ë–î
ALTER TABLE users ADD COLUMN bitrix24_user_id VARCHAR(255) NULL;
ALTER TABLE users ADD INDEX idx_bitrix24_user_id (bitrix24_user_id);
```

## Troubleshooting

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Laravel Scheduler –∑–∞–ø—É—â–µ–Ω:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ crontab
crontab -l

# –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞:
* * * * * cd /path-to-your-project && php artisan schedule:run >> /dev/null 2>&1
```

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `storage/logs/laravel.log`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ Bitrix24 –µ—Å—Ç—å email
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ email —É–Ω–∏–∫–∞–ª–µ–Ω (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º)

### –û—à–∏–±–∫–∞ "Webhook not configured"

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Webhook URL –≤ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí Bitrix24**:

1. –°–æ–∑–¥–∞–π—Ç–µ –≤—Ö–æ–¥—è—â–∏–π webhook –≤ Bitrix24
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ URL –≤–∏–¥–∞ `https://your-portal.bitrix24.ru/rest/1/xxxxx/`
3. –í—Å—Ç–∞–≤—å—Ç–µ –≤ –ø–æ–ª–µ "Webhook URL"
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω–∞—è

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏—é (50 –∑–∞–ø–∏—Å–µ–π –∑–∞ —Ä–∞–∑). –î–ª—è –±–æ–ª—å—à–∏—Ö –ø–æ—Ä—Ç–∞–ª–æ–≤:

-   –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å
-   –ó–∞–ø—É—Å–∫–∞–π—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –≤ –Ω–µ–ø–∏–∫–æ–≤—ã–µ —á–∞—Å—ã
-   –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `php artisan queue:work` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–∏

## –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```bash
# 1. –†—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ CLI
php artisan bitrix24:sync-users

# 2. –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f storage/logs/laravel.log | grep "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª"

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
php artisan tinker
>>> User::whereNotNull('bitrix24_user_id')->count()
>>> User::whereNotNull('bitrix24_user_id')->latest()->first()
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º

–ü–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:

-   ‚úÖ –î–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º –∑–∞ –±—Ä–æ–Ω—å (—Ä–æ–ª—å `employee` –∏–ª–∏ `manager`)
-   ‚úÖ –ú–æ–≥—É—Ç –≤—Ö–æ–¥–∏—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É (—Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è)
-   ‚úÖ –°–≤—è–∑–∞–Ω—ã —Å Bitrix24 —á–µ—Ä–µ–∑ `bitrix24_user_id`
-   ‚úÖ –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–¥–µ–ª–∫–∏ –≤ Bitrix24 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–∑–Ω–∞—á–∞—é—Ç—Å—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º

## –û—Ç–ª–∏—á–∏—è –æ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤

| –ü–∞—Ä–∞–º–µ—Ç—Ä   | –¢–æ–≤–∞—Ä—ã                   | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏                   |
| ---------- | ------------------------ | ------------------------------ |
| API –º–µ—Ç–æ–¥  | `crm.product.list`       | `user.get`                     |
| –§–∏–ª—å—Ç—Ä     | `CATALOG_ID`             | `ACTIVE = Y`                   |
| –°–æ–∑–¥–∞–Ω–∏–µ   | –ö–∞–∫ —É—Å–ª—É–≥–∏ (`services`)  | –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (`users`)     |
| –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ | –ù–∞–∑–≤–∞–Ω–∏–µ, —Ü–µ–Ω–∞, –æ–ø–∏—Å–∞–Ω–∏–µ | –ò–º—è, email, `bitrix24_user_id` |
| –ü–∞—Ä–æ–ª—å     | –ù/–î                      | **–ù–ï —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è**        |
| –†–æ–ª—å       | –ù/–î                      | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `employee`     |
| –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ | 00:00                    | 01:00                          |

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –æ—Ç–¥–µ–ª—É

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –æ—Ç–¥–µ–ª:

```php
// –í SyncUsersFromBitrix24Job::handle()
$response = $client->listUsers([
    'ACTIVE' => 'Y',
    'UF_DEPARTMENT' => 123, // ID –æ—Ç–¥–µ–ª–∞
], $start);
```

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π

–î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª—è –≤ –º–∏–≥—Ä–∞—Ü–∏—é –∏ –æ–±–Ω–æ–≤–∏—Ç–µ –ª–æ–≥–∏–∫—É:

```php
// –í SyncUsersFromBitrix24Job::syncUser()
$user->update([
    'bitrix24_user_id' => $bitrix24UserId,
    'name' => $name,
    'email' => $email,
    'phone' => $bitrixUser['PHONE'] ?? null, // –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω
    'position' => $bitrixUser['WORK_POSITION'] ?? null, // –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ª–∂–Ω–æ—Å—Ç—å
]);
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, —É–ø—Ä–æ—â–∞—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è —Å–≤—è–∑—å —Å CRM Bitrix24.

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Laravel –∏ Bitrix24 REST API.
